---
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Lottery Sphere</title>
		<style>
			body {
				margin: 0;
				overflow: hidden;
				background-color: #111; /* Dark background to make names pop */
				font-family: system-ui, sans-serif;
				color: white;
			}
			#sphere-container {
				width: 100vw;
				height: 100vh;
				position: relative;
			}
			canvas {
				display: block;
				width: 100%;
				height: 100%;
			}
			
			/* UI Overlay */
			#ui-layer {
				position: absolute;
				bottom: 40px;
				left: 50%;
				transform: translateX(-50%);
				display: flex;
				flex-direction: column;
				align-items: center;
				gap: 20px;
				z-index: 10;
				pointer-events: none; /* Let clicks pass through to canvas if needed, but buttons need pointer-events auto */
			}
			
			button {
				pointer-events: auto;
				padding: 12px 32px;
				font-size: 1.2rem;
				font-weight: bold;
				color: #fff;
				background: linear-gradient(45deg, #ff3366, #ff6b6b);
				border: none;
				border-radius: 50px;
				cursor: pointer;
				box-shadow: 0 4px 15px rgba(255, 51, 102, 0.4);
				transition: transform 0.2s, box-shadow 0.2s;
				text-transform: uppercase;
				letter-spacing: 1px;
			}
			
			button:hover {
				transform: translateY(-2px);
				box-shadow: 0 6px 20px rgba(255, 51, 102, 0.6);
			}
			
			button:active {
				transform: translateY(1px);
			}
			
			button:disabled {
				background: #555;
				cursor: not-allowed;
				box-shadow: none;
				transform: none;
			}

			#status-display {
				font-size: 1.5rem;
				font-weight: bold;
				text-shadow: 0 2px 4px rgba(0,0,0,0.8);
				min-height: 2rem;
			}

            /* Winners List */
            #winners-list-container {
                position: absolute;
                top: 20px;
                right: 20px;
                width: 250px;
                max-height: 50vh;
                background: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(5px);
                border-radius: 12px;
                padding: 15px;
                border: 1px solid rgba(255, 255, 255, 0.1);
                overflow-y: auto;
                pointer-events: auto;
            }
            
            #winners-list-container h3 {
                margin: 0 0 10px 0;
                font-size: 1rem;
                color: #aaa;
                text-transform: uppercase;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
                padding-bottom: 5px;
            }
            
            #winners-list {
                list-style: none;
                padding: 0;
                margin: 0;
            }
            
            #winners-list li {
                padding: 5px 0;
                font-size: 1.1rem;
                color: #ffd700;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            
            #winners-list li::before {
                content: '‚òÖ';
                font-size: 0.8rem;
                color: #ff3366;
            }

            /* Result Modal Overlay */
            #modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                backdrop-filter: blur(3px);
                z-index: 100;
                display: flex;
                justify-content: center;
                align-items: center;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s ease;
            }
            
            #modal-overlay.visible {
                opacity: 1;
                pointer-events: auto;
            }

			#result-modal {
				background: rgba(20, 20, 20, 0.95);
				padding: 50px 80px;
				border-radius: 20px;
				border: 1px solid rgba(255, 255, 255, 0.2);
				text-align: center;
				box-shadow: 0 0 50px rgba(0,0,0,0.5);
				transform: scale(0.9);
				transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
			}
			
            #modal-overlay.visible #result-modal {
                transform: scale(1);
            }
			
			.winner-title {
				font-size: 1.5rem;
				color: #fff;
				margin-bottom: 20px;
				text-transform: uppercase;
				letter-spacing: 2px;
			}
			
			.winner-name {
				font-size: 4rem;
				font-weight: 800;
				background: linear-gradient(45deg, #ffd700, #ffaa00, #ffea00);
                background-size: 200% auto;
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
				margin: 0;
                animation: shine 3s linear infinite;
			}
            
            @keyframes shine {
                to {
                    background-position: 200% center;
                }
            }

			.next-btn {
				margin-top: 40px;
                padding: 15px 40px;
                font-size: 1.3rem;
                background: white;
                color: #111;
			}
			
			.next-btn:hover {
                background: #eee;
				transform: translateY(-2px);
				box-shadow: 0 6px 20px rgba(255, 255, 255, 0.3);
			}
		</style>
	</head>
	<body>
		<div id="sphere-container">
			<canvas id="lottery-canvas"></canvas>
			
			<div id="ui-layer">
				<div id="status-display">ÂáÜÂ§áÂ∞±Áª™</div>
				<button id="start-btn">ÂºÄÂßãÊäΩÂ•ñ</button>
			</div>
            
            <div id="winners-list-container">
                <h3>Â∑≤‰∏≠Â•ñÂêçÂçï</h3>
                <ul id="winners-list">
                    <!-- Winners will be added here -->
                </ul>
            </div>
			
            <div id="modal-overlay">
                <div id="result-modal">
                    <div class="winner-title">üéâ ÊÅ≠Âñú üéâ</div>
                    <h2 class="winner-name" id="winner-name">---</h2>
                    <button class="next-btn" id="next-btn">‰∏ã‰∏Ä‰Ωç</button>
                </div>
            </div>
		</div>

		<script>
			import { LotterySphere } from '../components/LotterySphere';
			import names from '../data/name';

			const canvas = document.getElementById('lottery-canvas') as HTMLCanvasElement;
			const startBtn = document.getElementById('start-btn') as HTMLButtonElement;
			const statusDisplay = document.getElementById('status-display') as HTMLDivElement;
			const modalOverlay = document.getElementById('modal-overlay') as HTMLDivElement;
			const winnerNameEl = document.getElementById('winner-name') as HTMLHeadingElement;
			const nextBtn = document.getElementById('next-btn') as HTMLButtonElement;
            const winnersList = document.getElementById('winners-list') as HTMLUListElement;
			
			let sphere: LotterySphere | null = null;
			let isLotteryRunning = false;

			if (canvas) {
				// Initialize the sphere
				sphere = new LotterySphere(canvas, names);
			}
            
            // Clean up resources when the page is unloaded
            window.addEventListener('beforeunload', () => {
                if (sphere) {
                    sphere.destroy();
                }
            });

			function updateStatus(text: string) {
				if (statusDisplay) statusDisplay.textContent = text;
			}
            
            function addWinnerToList(name: string) {
                if (!winnersList) return;
                const li = document.createElement('li');
                li.textContent = name;
                // Insert at the top
                winnersList.insertBefore(li, winnersList.firstChild);
            }

			if (startBtn && sphere) {
				startBtn.addEventListener('click', () => {
					if (isLotteryRunning) return;
					
					isLotteryRunning = true;
					startBtn.disabled = true;
					updateStatus('ÊäΩÂ•ñ‰∏≠...');
					
					sphere?.startLottery((winner) => {
						isLotteryRunning = false;
						// Don't enable start btn yet, wait for "Next"
						updateStatus('ÊäΩÂ•ñÁªìÊùü');
						
						// Show result
						if (winnerNameEl) winnerNameEl.textContent = winner;
						modalOverlay.classList.add('visible');
                        
                        // Add to list immediately or after close? 
                        // Let's add immediately so it's there when they look back
                        addWinnerToList(winner);
					});
				});
			}
			
			if (nextBtn) {
				nextBtn.addEventListener('click', () => {
					modalOverlay.classList.remove('visible');
					updateStatus('ÂáÜÂ§áÂ∞±Áª™');
                    startBtn.disabled = false;
                    
                    // Remove winner from sphere
                    const winnerName = winnerNameEl.textContent;
                    if (winnerName && sphere) {
                        sphere.removeWinner(winnerName);
                    }
				});
			}
		</script>
	</body>
</html>
